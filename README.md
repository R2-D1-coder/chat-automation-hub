# WeChat Broadcast Automation Hub

åŸºäºç‹¬ç«‹çª—å£æ£€æµ‹çš„ Windows å¾®ä¿¡æ¡Œé¢å®¢æˆ·ç«¯**æ— äººå€¼å®ˆ**ç™½åå•ç¾¤å‘å·¥å…·ã€‚

> âš ï¸ **å£°æ˜**ï¼šæœ¬å·¥å…·ä»…ä¾›å­¦ä¹ å’Œå†…éƒ¨è‡ªåŠ¨åŒ–ä½¿ç”¨ã€‚è¯·éµå®ˆå¾®ä¿¡ä½¿ç”¨è§„èŒƒï¼Œé¿å…æ»¥ç”¨å¯¼è‡´è´¦å·é£æ§ã€‚

## âœ¨ åŠŸèƒ½ç‰¹æ€§

- âœ… **ç‹¬ç«‹çª—å£æ¨¡å¼**ï¼šé€šè¿‡ UI Automation ç²¾ç¡®å®šä½ç‹¬ç«‹èŠå¤©çª—å£ï¼Œå¯é æ€§é«˜
- âœ… **é—­ç¯éªŒè¯**ï¼šå‘é€å‰éªŒè¯çª—å£åç§°ï¼Œç¡®ä¿å‘åˆ°æ­£ç¡®çš„ç¾¤
- âœ… **Web ç®¡ç†ç•Œé¢**ï¼šå¯è§†åŒ–é…ç½®å®šæ—¶ä»»åŠ¡ï¼Œæ”¯æŒè¿œç¨‹è®¿é—®
- âœ… **å®šæ—¶ç¾¤å‘**ï¼šæ”¯æŒæ¯å¤©/æ¯å‘¨/æ¯æœˆç­‰å¤šç§è°ƒåº¦è§„åˆ™
- âœ… **ç™½åå•ç¾¤å‘**ï¼šä»…å‘é…ç½®çš„ç™½åå•ç¾¤å‘é€æ¶ˆæ¯
- âœ… **å›¾æ–‡æ¶ˆæ¯**ï¼šæ”¯æŒåŒæ—¶å‘é€å›¾ç‰‡å’Œæ–‡å­—
- âœ… **å»é‡æœºåˆ¶**ï¼šåŸºäºæ—¶é—´é—´éš”ï¼ŒåŒä¸€ç¾¤åœ¨æŒ‡å®šæ—¶é—´å†…ä¸ä¼šé‡å¤å‘é€
- âœ… **é™é¢‘ä¿æŠ¤**ï¼šæ»‘åŠ¨çª—å£é™æµï¼Œé»˜è®¤æ¯åˆ†é’Ÿæœ€å¤š 10 æ¡
- âœ… **è‡ªåŠ¨é‡è¯•**ï¼šæŒ‡æ•°é€€é¿ + éšæœºæŠ–åŠ¨ï¼Œå¤±è´¥è‡ªåŠ¨é‡è¯• 3 æ¬¡
- âœ… **å¤±è´¥æˆªå›¾**ï¼šå‘é€å¤±è´¥æ—¶è‡ªåŠ¨æˆªå›¾ä¿å­˜
- âœ… **å®‰å…¨ä¿é™©ä¸**ï¼šåŒé‡ä¿æŠ¤ï¼ˆ`armed` + `dry_run`ï¼‰ï¼Œé˜²æ­¢è¯¯æ“ä½œ

---

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ä¸€é”®å®‰è£…

```powershell
# 1. åŒå‡»è¿è¡Œ install.bat å®‰è£…ä¾èµ–
install.bat

# 2. åŒå‡»è¿è¡Œ start_web.bat å¯åŠ¨æœåŠ¡
start_web.bat

# 3. æµè§ˆå™¨è®¿é—®
http://localhost:5000
```

### âš ï¸ ä½¿ç”¨å‰æï¼ˆé‡è¦ï¼‰

**æœ¬å·¥å…·ä½¿ç”¨ã€Œç‹¬ç«‹çª—å£æ¨¡å¼ã€**ï¼Œè¿è¡Œå‰éœ€è¦æ‰‹åŠ¨æ‰“å¼€ç›®æ ‡ç¾¤çš„ç‹¬ç«‹èŠå¤©çª—å£ï¼š

1. åœ¨å¾®ä¿¡ä¸­**åŒå‡»**è¦ç¾¤å‘çš„èŠå¤©ï¼Œä½¿å…¶å˜æˆç‹¬ç«‹çª—å£
2. å»ºè®®å°†ç‹¬ç«‹çª—å£**ç½®é¡¶**ï¼Œé˜²æ­¢è¢«å…¶ä»–çª—å£é®æŒ¡
3. ä¿æŒç‹¬ç«‹çª—å£æ‰“å¼€çŠ¶æ€ï¼Œç„¶åè¿è¡Œä»»åŠ¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ä¸ªäººç¾¤    â”‚    â”‚   å®¶äººä»¬    â”‚    â”‚   å·¥ä½œç¾¤    â”‚
â”‚  (ç‹¬ç«‹çª—å£)  â”‚    â”‚  (ç‹¬ç«‹çª—å£)  â”‚    â”‚  (ç‹¬ç«‹çª—å£)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â†‘                 â†‘                  â†‘
       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   ç¨‹åºè‡ªåŠ¨æ£€æµ‹å¹¶å‘é€
```

---

## ğŸ–¥ï¸ Web ç®¡ç†ç•Œé¢

### å¯åŠ¨æœåŠ¡

```powershell
# æ–¹å¼1ï¼šåŒå‡»è¿è¡Œ
start_web.bat

# æ–¹å¼2ï¼šå‘½ä»¤è¡Œ
python run_web.py
```

### è®¿é—®åœ°å€

| è®¿é—®æ–¹å¼ | åœ°å€ |
|---------|------|
| æœ¬åœ°è®¿é—® | http://localhost:5000 |
| è¿œç¨‹è®¿é—® | http://ä½ çš„IP:5000 |

### è°ƒåº¦è§„åˆ™ç¤ºä¾‹

| éœ€æ±‚ | è°ƒåº¦è§„åˆ™ |
|------|----------|
| æ¯å¤©æ™šä¸Š 8 ç‚¹ | `daily 20:00` |
| æ¯å‘¨å…­ä¸­åˆ 12 ç‚¹ | `weekly 6 12:00` |
| æ¯æœˆ 1 æ—¥æ—©ä¸Š 9 ç‚¹ | `monthly 1 09:00` |
| æ ‡å‡† Cron | `0 20 * * *` |

---

## ğŸ”„ å·¥ä½œæµç¨‹

```mermaid
flowchart TD
    START([å¼€å§‹]) --> CHECK[æ£€æŸ¥ç‹¬ç«‹çª—å£]
    CHECK -->|æœªæ‰¾åˆ°| ERROR1[æç¤ºæ‰“å¼€ç‹¬ç«‹çª—å£]
    CHECK -->|æ‰¾åˆ°| WHITELIST{ç™½åå•æ ¡éªŒ}
    
    WHITELIST -->|ä¸é€šè¿‡| ERROR2[WhitelistError]
    WHITELIST -->|é€šè¿‡| SAFETY{å®‰å…¨ä¿é™©ä¸}
    
    SAFETY -->|æœªè§£é™¤| ERROR3[SafetyError]
    SAFETY -->|å·²è§£é™¤| LOOP[éå†ç›®æ ‡ç¾¤]
    
    LOOP --> FIND[æŒ‰ç¾¤åæŸ¥æ‰¾ç‹¬ç«‹çª—å£]
    FIND -->|æœªæ‰¾åˆ°| SKIP1[è·³è¿‡è¯¥ç¾¤]
    FIND -->|æ‰¾åˆ°| FOCUS[èšç„¦çª—å£]
    
    FOCUS --> VERIFY{éªŒè¯çª—å£å}
    VERIFY -->|ä¸åŒ¹é…| SKIP2[è·³è¿‡]
    VERIFY -->|åŒ¹é…| SEND[å‘é€æ¶ˆæ¯]
    
    SEND --> MARK[æ ‡è®°å·²å‘é€]
    MARK --> NEXT{è¿˜æœ‰ä¸‹ä¸€ä¸ª?}
    SKIP1 --> NEXT
    SKIP2 --> NEXT
    
    NEXT -->|æ˜¯| LOOP
    NEXT -->|å¦| DONE([å®Œæˆ])
```

---

## âš™ï¸ é…ç½®è¯´æ˜

### config.json ç¤ºä¾‹

```json
{
  "wechat": {
    "per_message_delay_sec": 2.0,
    "max_per_minute": 10,
    "min_send_interval_sec": 60,
    "screenshot_on_error": true
  },
  "safety": {
    "armed": false,
    "dry_run": true
  },
  "allowed_groups": [
    "ä¸ªäººç¾¤",
    "å®¶äººä»¬",
    "å·¥ä½œç¾¤"
  ],
  "broadcast": {
    "groups": ["ä¸ªäººç¾¤", "å®¶äººä»¬"],
    "text": "ã€é€šçŸ¥ã€‘å½“å‰æ—¶é—´: {ts}\nè¿™æ˜¯ä¸€æ¡è‡ªåŠ¨æ¶ˆæ¯ã€‚",
    "image": "assets/test_image.png"
  }
}
```

### å‚æ•°è¯´æ˜

| å‚æ•° | è¯´æ˜ | é»˜è®¤å€¼ |
|------|------|--------|
| `per_message_delay_sec` | æ¯æ¡æ¶ˆæ¯é—´éš”ï¼ˆç§’ï¼‰ | 2.0 |
| `max_per_minute` | æ¯åˆ†é’Ÿæœ€å¤§å‘é€æ•° | 10 |
| `min_send_interval_sec` | åŒä¸€ç¾¤æœ€å°å‘é€é—´éš”ï¼ˆç§’ï¼‰ | 60 |
| `screenshot_on_error` | å¤±è´¥æ—¶æˆªå›¾ | true |
| `armed` | å®‰å…¨ä¿é™©ä¸ | false |
| `dry_run` | è¯•è¿è¡Œæ¨¡å¼ | true |
| `allowed_groups` | ç™½åå•ç¾¤ç»„åˆ—è¡¨ | [] |

### å®‰å…¨æ¨¡å¼

| æ¨¡å¼ | `dry_run` | `armed` | è¡Œä¸º |
|------|-----------|---------|------|
| **é¢„è§ˆæ¨¡å¼**ï¼ˆé»˜è®¤ï¼‰ | `true` | `false` | åªæ‰“å°ï¼Œä¸å‘é€ |
| **ç¦æ­¢å‘é€** | `false` | `false` | æŠ›å‡ºå®‰å…¨å¼‚å¸¸ |
| **çœŸå®å‘é€** | `false` | `true` | å®é™…å‘é€æ¶ˆæ¯ |

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
chat-automation-hub/
â”œâ”€â”€ install.bat              # ä¸€é”®å®‰è£…è„šæœ¬
â”œâ”€â”€ start_web.bat            # ä¸€é”®å¯åŠ¨è„šæœ¬
â”œâ”€â”€ run_web.py               # Web æœåŠ¡å…¥å£
â”œâ”€â”€ tasks.py                 # Robocorp ä»»åŠ¡å…¥å£
â”œâ”€â”€ inspect_ui.py            # UI Inspector è°ƒè¯•å·¥å…·
â”œâ”€â”€ test_independent_windows.py  # ç‹¬ç«‹çª—å£æµ‹è¯•å·¥å…·
â”œâ”€â”€ config.json              # é…ç½®æ–‡ä»¶
â”œâ”€â”€ requirements.txt         # Python ä¾èµ–
â”‚
â”œâ”€â”€ web/                     # Web ç®¡ç†ç•Œé¢
â”‚   â”œâ”€â”€ app.py
â”‚   â”œâ”€â”€ models.py
â”‚   â”œâ”€â”€ scheduler.py
â”‚   â””â”€â”€ templates/
â”‚
â”œâ”€â”€ src/                     # æ ¸å¿ƒä»£ç 
â”‚   â”œâ”€â”€ core/                # æ ¸å¿ƒæ¨¡å—
â”‚   â”‚   â”œâ”€â”€ config.py
â”‚   â”‚   â”œâ”€â”€ storage.py
â”‚   â”‚   â”œâ”€â”€ dedupe.py
â”‚   â”‚   â”œâ”€â”€ ratelimit.py
â”‚   â”‚   â”œâ”€â”€ retry.py
â”‚   â”‚   â””â”€â”€ log.py
â”‚   â””â”€â”€ adapters/
â”‚       â””â”€â”€ wechat_desktop.py  # å¾®ä¿¡é€‚é…å™¨ï¼ˆç‹¬ç«‹çª—å£ç‰ˆï¼‰
â”‚
â”œâ”€â”€ assets/                  # èµ„æºæ–‡ä»¶
â”‚   â””â”€â”€ uploads/
â”‚
â””â”€â”€ output/                  # è¿è¡Œè¾“å‡º
    â”œâ”€â”€ state.db
    â”œâ”€â”€ scheduler.db
    â””â”€â”€ wechat_error_*.png
```

---

## ğŸ” è°ƒè¯•å·¥å…·

### UI Inspector

æ£€æŸ¥ Windows UI å…ƒç´ ï¼Œå¸®åŠ©è°ƒè¯•ï¼š

```powershell
python inspect_ui.py        # äº¤äº’æ¨¡å¼
python inspect_ui.py -m     # é¼ æ ‡è¿½è¸ªæ¨¡å¼
python inspect_ui.py -l     # åˆ—å‡ºæ‰€æœ‰çª—å£
```

### ç‹¬ç«‹çª—å£æµ‹è¯•

æµ‹è¯•ç‹¬ç«‹çª—å£æ£€æµ‹å’Œå‘é€ï¼š

```powershell
python test_independent_windows.py --list   # åˆ—å‡ºç‹¬ç«‹çª—å£
python test_independent_windows.py --dry    # æ¨¡æ‹Ÿå‘é€
python test_independent_windows.py --send   # çœŸå®å‘é€
```

---

## âš ï¸ å¸¸è§é—®é¢˜

### 1. ã€Œæœªæ‰¾åˆ°ç‹¬ç«‹çª—å£ã€

- ç¡®ä¿å·²åœ¨å¾®ä¿¡ä¸­**åŒå‡»èŠå¤©**æ‰“å¼€ç‹¬ç«‹çª—å£
- çª—å£åå¿…é¡»ä¸ `allowed_groups` ä¸­çš„ç¾¤åä¸€è‡´

### 2. å‘é€åˆ°é”™è¯¯çš„ç¾¤

- æ£€æŸ¥ç¾¤åæ˜¯å¦å”¯ä¸€
- é¿å…ç¾¤åè¿‡äºç®€çŸ­æˆ–ç›¸ä¼¼

### 3. é”å±å¯¼è‡´å¤±è´¥

- è¿è¡Œæ—¶ä¿æŒå±å¹•è§£é”
- ç¦ç”¨è‡ªåŠ¨é”å±

### 4. é£æ§å»ºè®®

- `max_per_minute` è®¾ä¸º 5-10
- `per_message_delay_sec` è®¾ä¸º 2-5 ç§’
- é¿å…çŸ­æ—¶é—´å¤§é‡ç¾¤å‘

### 5. 500 Internal Server Error

```powershell
# åœæ­¢æ‰€æœ‰ Python è¿›ç¨‹åé‡å¯
Get-Process python* -ErrorAction SilentlyContinue | Stop-Process -Force
python run_web.py
```

---

## ğŸ”§ å‘½ä»¤è¡Œä½¿ç”¨

### é‡å¯é¡¹ç›®

```powershell
# ä¸€é”®é‡å¯ï¼ˆåœæ­¢æ‰€æœ‰ Python è¿›ç¨‹å¹¶é‡æ–°å¯åŠ¨ï¼‰
Get-Process python* -ErrorAction SilentlyContinue | Stop-Process -Force; python run_web.py
```

### è¿è¡Œä»»åŠ¡

```powershell
# é¢„è§ˆæ¨¡å¼ï¼ˆä¸å®é™…å‘é€ï¼‰
python -m robocorp.tasks run tasks.py -t wechat_broadcast

# çœŸå®å‘é€ï¼ˆéœ€ä¿®æ”¹ config.json: armed=true, dry_run=falseï¼‰
python -m robocorp.tasks run tasks.py -t wechat_broadcast

# è¿è¡Œè‡ªæµ‹
python -m robocorp.tasks run tasks.py -t self_test_core
```

---

## ğŸ”’ å®‰å…¨æœºåˆ¶

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ä¸‰å±‚å®‰å…¨é˜²æŠ¤                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ä¸€å±‚: ç™½åå• (allowed_groups)                     â”‚
â”‚    â†’ åªèƒ½å‘é€åˆ°é¢„è®¾çš„ç¾¤                              â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬äºŒå±‚: dry_run æ¨¡å¼                               â”‚
â”‚    â†’ é»˜è®¤åªæ¨¡æ‹Ÿï¼Œä¸çœŸæ­£å‘é€                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  ç¬¬ä¸‰å±‚: armed ä¿é™©ä¸                               â”‚
â”‚    â†’ å¿…é¡»æ˜¾å¼è®¾ä¸º true æ‰èƒ½å‘é€                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“œ è®¸å¯è¯

MIT License

---

## ğŸ™ è‡´è°¢

- [uiautomation](https://github.com/yinkaisheng/Python-UIAutomation-for-Windows) - Windows UI è‡ªåŠ¨åŒ–
- [Robocorp](https://robocorp.com/) - Python RPA æ¡†æ¶
- [Flask](https://flask.palletsprojects.com/) - Web æ¡†æ¶
- [APScheduler](https://apscheduler.readthedocs.io/) - å®šæ—¶è°ƒåº¦
